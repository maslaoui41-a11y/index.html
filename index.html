<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Birthday Cake</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
  body { margin: 0; overflow: hidden; background-color: #000; }
  #message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Pacifico', cursive;
    font-size: 4em;
    color: #ff0000; /* لون أحمر جميل */
    text-align: center;
    opacity: 0;
    transition: opacity 2s;
    text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff6666, 0 0 40px #ff6666;
  }
  canvas { display: block; }
</style>
</head>
<body>
<div id="message">Happy Birthday My Love</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// إضاءة
const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambientLight);
const pointLight = new THREE.PointLight(0xffffff, 1);
pointLight.position.set(0, 10, 10);
scene.add(pointLight);

// الكعكة
const colors = [0x4b2e2e, 0x4b2e2e, 0x4b2e2e];
const layers = [2, 1.5, 1];
const radii = [3, 2.5, 2];
let yPos = 0;
const cakeParts = [];
for (let i=0; i<layers.length; i++){
  const geo = new THREE.CylinderGeometry(radii[i], radii[i], layers[i], 32);
  const mat = new THREE.MeshStandardMaterial({color: colors[i]});
  const layer = new THREE.Mesh(geo, mat);
  layer.position.y = yPos + layers[i]/2;
  yPos += layers[i];
  scene.add(layer);
  cakeParts.push(layer);

  const topGeo = new THREE.CircleGeometry(radii[i], 32);
  const topMat = new THREE.MeshStandardMaterial({color:0xff69b4});
  const top = new THREE.Mesh(topGeo, topMat);
  top.rotation.x = -Math.PI/2;
  top.position.y = yPos;
  scene.add(top);
  cakeParts.push(top);
}

// الشموع
const candleHeight=1, candleRadius=0.05;
const candles=[], flames=[];
for (let i=0; i<18; i++){
  const angle=(i/18)*Math.PI*2;
  const x=2*Math.cos(angle), z=2*Math.sin(angle);
  const candle = new THREE.Mesh(new THREE.CylinderGeometry(candleRadius, candleRadius, candleHeight,16), new THREE.MeshStandardMaterial({color:0xff0000}));
  candle.position.set(x, yPos + candleHeight/2, z);
  scene.add(candle);
  candles.push(candle);

  const flame = new THREE.PointLight(0xffff66, 1.5, 3);
  flame.position.set(x, yPos + candleHeight, z);
  scene.add(flame);
  flames.push(flame);
}

camera.position.set(0,5,10);
camera.lookAt(0,yPos/2,0);

// النجوم الخلفية بعد ظهور الرسالة
const starGeo = new THREE.BufferGeometry();
const starCount = 150;
const starPositions = new Float32Array(starCount*3);
for(let i=0;i<starCount*3;i++){
  starPositions[i] = (Math.random()-0.5)*50;
}
starGeo.setAttribute('position', new THREE.BufferAttribute(starPositions,3));
const starMat = new THREE.PointsMaterial({color:0xffffff, size:0.1});
const stars = new THREE.Points(starGeo, starMat);
stars.visible = false; // ستظهر بعد نفخ الشموع
scene.add(stars);

const clock = new THREE.Clock();
let blowing=false, blowProgress=0;

function animate(){
  requestAnimationFrame(animate);
  const time = clock.getElapsedTime();

  if(!blowing){
    flames.forEach((f,i)=>{
      f.position.y = yPos + candleHeight + 0.05*Math.sin(time*5 + i);
      f.intensity = 1.2 + 0.3*Math.sin(time*10 + i);
    });
  } else {
    blowProgress += 0.02;
    candles.forEach(c=>c.scale.y = Math.max(0,1-blowProgress));
    flames.forEach(f=>f.intensity = Math.max(0,1.5-blowProgress*10));
    cakeParts.forEach(p=>{p.material.opacity=Math.max(0,1-blowProgress*1.2); p.material.transparent=true;});
    if(blowProgress>=1){
      document.getElementById('message').style.opacity=1;
      stars.visible=true;
    }
  }

  // تحريك النجوم
  if(stars.visible){
    const positions = stars.geometry.attributes.position.array;
    for(let i=1;i<positions.length;i+=3){
      positions[i]-=0.05; // تحرك عمودي
      if(positions[i]<-10) positions[i]=25; // إعادة النجوم للأعلى
    }
    stars.geometry.attributes.position.needsUpdate = true;
  }

  renderer.render(scene,camera);
}
animate();

// بدء نفخ الشموع بعد 5 ثوانٍ
setTimeout(()=>{blowing=true;},5000);

window.addEventListener('resize', ()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
